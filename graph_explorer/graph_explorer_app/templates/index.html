<!DOCTYPE html>
<html lang="en">
<head>
      <script src="https://d3js.org/d3.v7.min.js"></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Graph Visualizer – Sketch UI</title>
  <link href="https://fonts.googleapis.com/css2?family=Gloria+Hallelujah&display=swap" rel="stylesheet">
  <style>
    :root {
      --ink: #222;
      --bg: #fff;
      --panel: #fafafa;
      --chip: #f3f3f3;
      --stroke: 2px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--ink);
      font-family: "Gloria Hallelujah", cursive, sans-serif;
      line-height: 1.3;
    }

    .sketch {
      border: var(--stroke) solid var(--ink);
      box-shadow: 0.2em 0.2em 0 0 var(--ink);
    }

    .app {
      display: grid;
      grid-template-rows: auto auto 1fr;
      grid-template-columns: minmax(15ch, 25%) 1fr;
      grid-template-areas:
        "titlebar titlebar"
        "tabs toolbar"
        "sidebar main";
      gap: 0.5em;
      height: 100vh;
      padding: 0.5em;
    }

    /* Title bar */
    .titlebar {
      grid-area: titlebar;
      display: flex;
      flex-direction: row;
      gap: 15em;
      padding: 0.5em;
      border-bottom: var(--stroke) solid var(--ink);
      align-items: center;
    }

    .title { font-size: 2rem; font-weight: 600; }
    .label { font-size: 1.2rem; }

    .input {
      padding: 0.3em 0.6em;
      font: inherit;
      background: #fff;
      border: var(--stroke) solid var(--ink);
      box-shadow: 0.15em 0.15em 0 var(--ink);
      width: 100%;
    }

    /* Tabs & toolbar row */
    .tabs {
      grid-area: tabs;
      display: flex;
      gap: 0.5em;
      padding: 0.5em;
      height: 70%;
    }

    .tab {
      padding: 0.3em 0.8em;
      cursor: pointer;
      border: var(--stroke) solid var(--ink);
      background: var(--chip);
      box-shadow: 0.15em 0.15em 0 var(--ink);
    }

    .toolbar {
      grid-area: toolbar;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10em;
      padding: 0.5em;
    }

    .button {
      font-family: "Gloria Hallelujah", cursive, sans-serif;
      padding: 0.3em 0.8em;
      margin-left: 5%;
      border: var(--stroke) solid var(--ink);
      background: var(--chip);
      cursor: pointer;
      box-shadow: 0.15em 0.15em 0 var(--ink);
    }

    /* Sidebar */
    .sidebar {
      grid-area: sidebar;
      overflow: hidden;
      padding: 0.5em;
      border-right: var(--stroke) solid var(--ink);
      display: flex;
      flex-direction: column;
      gap: 0.5em;
      height: 100%;
    }

    /* Filter UI */
    .filter-section {
      border: var(--stroke) solid var(--ink);
      box-shadow: 0.15em 0.15em 0 var(--ink);
      padding: 0.5em;
      background: var(--panel);
      font-size: 1rem;
      width: 80%;
    }

    .filter-row {
      display: flex;
      align-items: center;
      gap: 0.5em;
      margin-bottom: 0.5em;
    }

    .filter-input {
      flex: 1;
      padding: 0.3em 0.6em;
      font: inherit;
      border: var(--stroke) solid var(--ink);
      background: #fff;
      box-shadow: 0.15em 0.15em 0 var(--ink);
    }

    .applied-queries {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5em;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 0.3em;
      padding: 0.2em 0.6em;
      border: var(--stroke) solid var(--ink);
      background: var(--chip);
      box-shadow: 0.15em 0.15em 0 var(--ink);
    }

    .chip button {
      border: none;
      background: none;
      cursor: pointer;
      font-weight: bold;
    }

    #tree-view {
      flex: 6.5;
      min-height: 0;
      overflow-y: auto;
    }

    #bird-view {
      width: 100%;
      aspect-ratio: 16/9;
      min-height: 150px; /* optional fallback */
    }




    .view-section {
      border: var(--stroke) solid var(--ink);
      box-shadow: 0.15em 0.15em 0 var(--ink);
      padding: 0.5em;
      min-height: 10em;
      background: var(--panel);
    }

    .view-title {
      font-weight: bold;
      margin-bottom: 0.5em;
    }

    /* Main canvas */
    .main {
      grid-area: main;
      display: flex;
      flex-direction: column;
      padding: 0.5em;
    }

    .canvas {
      flex: 1;
      border: var(--stroke) solid var(--ink);
      background: var(--panel);
    }

    /* Operators */
    .operators {
      display: flex;
      gap: 0.3em;
    }

    .op-btn {
      padding: 0.2em 0.5em;
      font: inherit;
      border: var(--stroke) solid var(--ink);
      background: var(--chip);
      cursor: pointer;
      box-shadow: 0.15em 0.15em 0 var(--ink);
    }

    .op-btn:hover {
      background: #e6e6e6;
    }
  </style>
</head>
<body>
  <div class="app sketch">
    <div class="titlebar">
      <div class="title">Graph Visualizer</div>

      <div style="display: flex; flex-direction: row; gap: 2em;">
        <label class="label">Search:</label>
        <input class="input" type="text" placeholder="Find node...">
      </div>

      <div style="display: flex; flex-direction: row; gap: 2em;">
        <label class="label">File:</label>
        <input class="input" type="file" id="filePicker" accept=".json,.csv">
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <div class="tab sketch">Simple View</div>
      <div class="tab sketch">Block View</div>
    </div>

    <!-- Toolbar with filter -->
    <div class="toolbar">
      <div class="filter-section sketch">
        <div class="filter-row">
          <label class="label">Filter:</label>
          <input class="filter-input" type="text">
          <div class="operators">
            <button class="op-btn">&gt;</button>
            <button class="op-btn">&lt;</button>
            <button class="op-btn">≥</button>
            <button class="op-btn">≤</button>
          </div>
          <input class="filter-input" type="text">
          <div>
            <button class="button sketch">APPLY</button>
          </div>
        </div>
        <div class="applied-queries"></div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar sketch">
      <div class="view-section sketch" id="tree-view">
        <div class="view-title">Tree View</div>
        <hr>
        <!-- Tree structure will render here -->
      </div>

      <div class="view-section sketch" id="bird-view">
        <div class="view-title">Bird View</div>
        <hr>
        <div id="bird-content"></div>
      </div>
    </div>

    <!-- Main -->
    <div class="main">
      <div style="font-size: 2em;">Main view</div>
      <div class="canvas sketch">
        <!-- Main visualization canvas -->
          {{ graph_html|safe }}
      </div>
    </div>
  </div>
<script>
function updateBirdViewAspect() {
    const mainSvg = d3.select(".canvas svg");
    const birdSvg = d3.select("#bird-content svg");

    // If no bird view SVG yet, clone main SVG structure
    if (birdSvg.empty()) {
        const mainClone = mainSvg.node().cloneNode(true);
        d3.select("#bird-content").append(() => mainClone);
    }

    const birdContainer = d3.select("#bird-content svg g");
    const mainNodes = d3.select(".canvas svg g.nodes").selectAll("circle").nodes();

    if (!mainNodes.length) return;

    // Compute bounding box of all nodes
    let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
    mainNodes.forEach(n => {
        const cx = +n.getAttribute("cx");
        const cy = +n.getAttribute("cy");
        minX = Math.min(minX, cx);
        minY = Math.min(minY, cy);
        maxX = Math.max(maxX, cx);
        maxY = Math.max(maxY, cy);
    });

    const graphWidth = maxX - minX;
    const graphHeight = maxY - minY;

    const birdSvgEl = d3.select("#bird-content svg").node();
    const birdWidth = birdSvgEl.clientWidth;
    const birdHeight = birdSvgEl.clientHeight;

    const scale = Math.min(birdWidth / graphWidth, birdHeight / graphHeight) * 0.9; // 0.9 to give some padding

    const offsetX = (birdWidth - graphWidth * scale) / 2 - minX * scale;
    const offsetY = (birdHeight - graphHeight * scale) / 2 - minY * scale;

    // Apply transform to the bird view <g>
    birdContainer.attr("transform", `translate(${offsetX},${offsetY}) scale(${scale})`);
}

</script>


<script>
window.addEventListener("load", updateBirdViewAspect)
window.addEventListener("resize", updateBirdViewAspect);
</script>
</body>
</html>
